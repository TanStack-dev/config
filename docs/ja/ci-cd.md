---
source-updated-at: '2025-03-04T06:01:52.000Z'
translation-updated-at: '2025-05-06T20:31:42.787Z'
id: ci-cd
title: CI/CD
---
## GitHub ワークフロー

- `pr.yml`:
    - すべてのプルリクエストに対してテストを実行
    - `nx affected` を実行し、キャッシュが無効化されたタスクのみを処理
    - `pkg-pr-new` を使用してパッケージプレビューを公開し、サンプルへのリンクを作成
- `release.yml`:
    - リリースブランチにマージされたコードに対してテストを実行
    - `nx run-many` を実行し、すべてのタスクを処理して出力が存在することを確認（ビルド公開に必要）
    - [Changesets](https://github.com/changesets/changesets) を使用してバージョニングと公開を管理

## Nx

TanStackプロジェクトでは、テストとビルドを高速に実行するためにNxを採用しています。タスクは並列化され、ローカル環境とCI環境の両方でキャッシュされます。Nxには豊富なプラグインシステムがありますが、ここではNPMスクリプトランナーとしてのみ利用しています。

### 設定ファイル

- `./nx.json`: タスクの依存関係、入力、出力を定義するメイン設定ファイル
- `./package.json`: ルートレベルのスクリプト（例: `test:format`）を手動で指定する必要あり
- `./**/package.json`: パッケージレベルのスクリプト（例: `build`）は自動検出されます

### Nx エージェント

- NxではCIマシン間でタスクを分散でき、並列実行可能なジョブ数を増加可能
- ただし、起動時にかなりの遅延が発生することに注意が必要
